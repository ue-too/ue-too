{
    "$schema": "../../board-game-engine/schema/json-schema/game-definition.schema.json",
    "actions": [
        {
            "description": "Place an X or O marker on an empty cell",
            "displayName": "Place Marker",
            "effects": [
                {
                    "component": "Cell",
                    "entity": "$target.0",
                    "type": "setComponentValue",
                    "values": {
                        "occupied": true
                    }
                },
                {
                    "components": {
                        "GridLocation": {
                            "column": "$component.$target.0.GridLocation.column",
                            "grid": null,
                            "q": null,
                            "r": null,
                            "row": "$component.$target.0.GridLocation.row"
                        },
                        "Marker": {
                            "playerIndex": 0,
                            "value": "X"
                        }
                    },
                    "eventType": "EntityCreated",
                    "storeAs": "newMarker",
                    "type": "createEntity",
                    "zone": "board"
                },
                {
                    "condition": {
                        "component": "Player",
                        "entity": "$actor",
                        "property": "playerNumber",
                        "type": "componentValueCheck",
                        "value": 2
                    },
                    "then": [
                        {
                            "component": "Marker",
                            "entity": "$newMarker",
                            "type": "setComponentValue",
                            "values": {
                                "playerIndex": 1,
                                "value": "O"
                            }
                        }
                    ],
                    "type": "conditional"
                },
                {
                    "type": "checkTicTacToeWin"
                },
                {
                    "type": "switchActivePlayer"
                }
            ],
            "id": "PlaceMarker",
            "name": "PlaceMarker",
            "preconditions": [
                {
                    "type": "isPlayerTurn"
                },
                {
                    "component": "Cell",
                    "entity": "$target.0",
                    "errorMessage": "Cell is already occupied",
                    "property": "occupied",
                    "type": "componentValueCheck",
                    "value": false
                }
            ],
            "targetCount": 1,
            "targeting": {
                "count": 1,
                "validTargets": {
                    "hasComponent": ["Cell"],
                    "owner": "any",
                    "zone": "board"
                }
            }
        }
    ],

    "components": {
        "Cell": {
            "properties": {
                "occupied": { "default": false, "type": "boolean" }
            }
        },
        "GridLocation": {
            "properties": {
                "column": { "default": null, "type": "number" },
                "grid": { "default": null, "type": "entity" },
                "q": { "default": null, "type": "number" },
                "r": { "default": null, "type": "number" },
                "row": { "default": null, "type": "number" }
            }
        },
        "Marker": {
            "properties": {
                "playerIndex": { "default": 0, "type": "number" },
                "value": { "default": "", "type": "string" }
            }
        },
        "Player": {
            "properties": {
                "hasWon": { "default": false, "type": "boolean" }
            }
        }
    },

    "entityTemplates": {
        "Cell": {
            "components": {
                "Cell": {
                    "occupied": false
                },
                "GridLocation": {
                    "column": 0,
                    "grid": null,
                    "q": null,
                    "r": null,
                    "row": 0
                }
            }
        },
        "Player": {
            "components": {}
        }
    },

    "metadata": {
        "author": "ue-too",
        "complexity": "simple",
        "description": "Classic 3x3 tic-tac-toe game - simplified version",
        "maxPlayers": 2,
        "minPlayers": 2,
        "tags": ["grid", "strategy", "classic"]
    },

    "name": "Tic-Tac-Toe",
    "phases": [
        {
            "allowedActions": ["PlaceMarker"],
            "autoAdvance": false,
            "name": "Play"
        }
    ],

    "rules": [
        {
            "conditions": [],
            "effects": [
                {
                    "type": "checkTicTacToeWin"
                }
            ],
            "id": "check-win-after-marker-placed",
            "priority": 100,
            "trigger": {
                "eventType": "EntityCreated",
                "filters": {}
            }
        }
    ],

    "setup": {
        "initialPhase": "Play",
        "perPlayer": {
            "template": "Player",
            "zones": []
        },
        "playerCount": { "max": 2, "min": 2 },
        "sharedZoneEntities": [
            {
                "count": 9,
                "template": "Cell",
                "zone": "board"
            }
        ]
    },

    "version": "1.0.0",
    "winConditions": [
        {
            "condition": {
                "component": "Player",
                "entity": "$actor",
                "property": "hasWon",
                "type": "componentValueCheck",
                "value": true
            },
            "description": "A player has three markers in a row, column, or diagonal",
            "id": "player-wins",
            "message": "Three in a row! You win!",
            "name": "Player Wins",
            "winner": "actor"
        }
    ],
    "zones": {
        "board": {
            "maxCapacity": 18,
            "ordered": false,
            "shared": true,
            "visibility": "public"
        }
    }
}
